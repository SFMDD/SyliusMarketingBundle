{% import "@FMDDSyliusMarketingPlugin/Include/marketing_macro.html.twig" as marketing %}
{% set order = settings.order %}
<script>
    tarteaucitron.user.gtagMore = function () {
        gtag('event', 'checkout_progress', {
            "items": [
                {% for item in order.items %}
                {{ marketing.product_data(item.getVariant, (item.subtotal/100)|round(2, 'common'), item.quantity, null, loop.index+1, null) }},
                {% endfor %}
            ],
            "coupon": ""
        });
    };
    (tarteaucitron.job = tarteaucitron.job || []).push('gtag');


    {% set google_adwords = sylius.channel.googleAdwords %}
    {% set google_event_checkout_progress = sylius.channel.googleEventCheckoutProgress %}
    {% if google_adwords is not empty and google_event_checkout_progress is not empty  %}
        <!-- Event snippet for Initialisation choice shipping conversion page -->
        gtag('event', 'conversion', {'send_to': '{{ google_adwords }}/{{ google_event_checkout_progress }}'});
    {% endif %}
</script>
