{% import "@FMDDSyliusMarketingPlugin/Include/marketing_macro.html.twig" as marketing %}
{% set products = settings.attr.products %}
{% if products|length > 0 %}
    <script>
        var items = [
            {% for product in products %}
            {% if product.mainTaxon is not null %}
            {% set mt = product.mainTaxon.name %}
            {% else %}
            {% set mt = "not set" %}
            {% endif %}
            {{ marketing.impression_data(product.id, product.name,
                sylius.channel.name|capitalize, product.mainTaxon, loop.index, null,
                null, "Taxon : "~mt) }},
            {#
                    {{ marketing.impression_data(product.id, product.name,
                sylius.channel.name|capitalize, product.mainTaxon, loop.index, (product|sylius_resolve_variant|sylius_calculate_price({'channel': sylius.channel})/100)|round(0, 'common'),
                null, "Taxon : "~mt) }},
            #}

            {% endfor %}
        ];
        tarteaucitron.user.gtagMore = function () {
            gtag('event', 'view_item_list', {
                "items": items
            });
        };
        (tarteaucitron.job = tarteaucitron.job || []).push('gtag');
    </script>
{% endif %}
