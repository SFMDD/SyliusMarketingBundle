{% import "@FMDDSyliusMarketingPlugin/Include/marketing_macro.html.twig" as marketing %}
<script>
    tarteaucitron.user.gtagMore = function () {
        gtag('event', 'view_item_list', {
            "items": [
                {% for variant in settings.attr.variants %}
                {% set product = variant.product %}
                {{ marketing.impression_data(product.id, product.name,
                    website_name, product.mainTaxon.slug, loop.index, (product|sylius_resolve_variant|sylius_calculate_price({'channel': sylius.channel})/100)|round(0, 'common'),
                null, "Promotion") }},
                {% endfor %}
            ]
        });
        gtag('event', 'view_promotion', {
            "promotions": [
                {
                    "id": "view_promo",
                    "name": "Promotion Page"
                }
            ]
        });
    };
    (tarteaucitron.job = tarteaucitron.job || []).push('gtag');
</script>
