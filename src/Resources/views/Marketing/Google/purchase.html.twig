{% import "@FMDDSyliusMarketingPlugin/Include/marketing_macro.html.twig" as marketing %}
{% set order = settings.order %}
<script>
    tarteaucitron.user.gtagMore = function () {

        {% if google_adwords is not empty and google_event_purchase is not empty  %}
            gtag('event', 'conversion', {
                'send_to': '{{ google_adwords }}/{{ google_event_purchase }}',
                'value': '{{ (order.total/100)|round(2, 'common') }}',
                'currency': 'EUR',
                'transaction_id': '{{ order.id }}'
            });
        {% endif %}
        gtag('event', 'purchase', {
            "transaction_id": "{{ order.id }}",
            "affiliation": {{ website_name }},
            "value": {{ (order.total/100)|round(2, 'common') }},
            "currency": "EUR",
            "tax": 1.00,
            "shipping": 0,
            "items": [
                {% for item in order.items %}
                {{ marketing.product_data(item.getVariant.code, item.getVariant.name,
                    website_name, item.getVariant.product.mainTaxon.slug,
                (item.subtotal/100)|round(2, 'common'), item.quantity, null, loop.index+1, null)
                }},
                {% endfor %}
            ]
        });
    };
    (tarteaucitron.job = tarteaucitron.job || []).push('gtag');
</script>
