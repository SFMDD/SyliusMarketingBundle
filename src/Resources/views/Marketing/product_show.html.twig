{% import "@FMDDSyliusMarketingPlugin/Include/marketing_macro.html.twig" %}
<script>
    tarteaucitron.user.gtagMore = function () {
        gtag('event', 'view_item', {
            "items": [
                {{ marketing.impression_data(product.id, product.name,
                    website_name, product.mainTaxon.slug, 1, (product|sylius_resolve_variant|sylius_calculate_price({'channel': sylius.channel})*1.2/100)|round(0, 'common'),
                null, "product_show") }}
            ]
        });

        function gtag_report_conversion(url) {
            var callback = function () {
                if (typeof(url) != 'undefined') {
                    window.location = url;
                }
            };
            gtag('event', 'conversion', {
                'send_to': {{ google_conversion }},
                'event_callback': callback
            });
            return false;
        }
    };
    (tarteaucitron.job = tarteaucitron.job || []).push('gtag');
</script>
